<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="LG Electronics America R&D Center">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>NPC map navigation - LGSVL Simulator</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="../css/extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "NPC map navigation";
    var mkdocs_page_input_path = "npc-map-navigation.md";
    var mkdocs_page_url = "/npc-map-navigation/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-130546445-1', 'lgsvlsimulator.com/docs');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <!-- edit link, open in new tab -->
        <a href="https://www.lgsvlsimulator.com" class="icon icon-home" target="_blank_"> LGSVL Simulator</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Quick start</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../getting-started/">Getting started</a>
                </li>
                <li class="">
                    
    <a class="" href="../keyboard-shortcuts/">Keyboard shortcuts</a>
                </li>
                <li class="">
                    
    <a class="" href="../changelog/">Release notes</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Web User Interface</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../maps-tab/">Maps</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../vehicles-tab/">Vehicles</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../sensor-json-options/">Sensor parameters</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../clusters-tab/">Clusters</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../simulations-tab/">Simulations</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Simulation User Interface</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../simulation-menu/">Menu items</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../sensor-visualizers/">Sensor visualization</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../bridge-connection-ui/">Bridge topics</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../config-and-cmd-line-params/">Configuration File and Command Line Parameters</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Integration with AD</span>
    <ul class="subnav">
                <li class="">
                    
    <span class="caption-text">Running with Autoware.AI</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../autoware-instructions/">Instructions</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../autoware-json-example/">Sample sensor configuration</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Running with Autoware.Auto</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../autoware-auto-instructions/">Instructions</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../autoware-auto-json-example/">Sample sensor configuration</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Running with latest Apollo</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../apollo-master-instructions/">Instructions</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../modular-testing/">Modular testing</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Running with Apollo 5.0</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../apollo5-0-instructions/">Instructions</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../apollo5-0-json-example/">Sample sensor configuration</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Running with Apollo 3.0</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../apollo-instructions/">Instructions</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../apollo-json-example/">Sample sensor configuration</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">LGSVL ROS/ROS2 Message Definitions</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../lgsvl-msgs/">The lgsvl_msgs package</a>
                </li>
                <li class="toctree-l3">
                    
    <span class="caption-text">Ground truth obstacles</span>
    <ul class="subnav">
                <li class="toctree-l4">
                    
    <a class="" href="../perception-ground-truth/">Viewing and subscribing to ground truth data</a>
                </li>
                <li class="toctree-l4">
                    
    <a class="" href="../ground-truth-json-example/">Sample sensor configuration for data collection</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Python API</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../python-api/">Python API guide</a>
                </li>
                <li class="">
                    
    <a class="" href="../api-quickstart-descriptions/">Python API quickstart examples</a>
                </li>
                <li class="">
                    
    <a class="" href="../api-example-descriptions/">Python API use case examples</a>
                </li>
                <li class="">
                    
    <a class="" href="../api-how-to-run-scenario/">How to run a scenario</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Tutorials</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../openai-gym/">Reinforcement learning with OpenAI Gym</a>
                </li>
                <li class="">
                    
    <a class="" href="../lane-following/">Deep Learning lane following model</a>
                </li>
                <li class="">
                    
    <a class="" href="../create-ros2-ad-stack/">How to create a simple ROS2-based AD stack</a>
                </li>
                <li class="">
                    
    <a class="" href="../control-calibration/">How to collect data with control calibration sensor</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Advanced</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../simulator-messages/">Supported message types</a>
                </li>
                <li class="">
                    
    <a class="" href="../simulator-coordinate-system/">Simulator coordinate system</a>
                </li>
                <li class="">
                    
    <a class="" href="../map-annotation/">Map annotation</a>
                </li>
                <li class="">
                    
    <a class="" href="../build-instructions/">Build instructions</a>
                </li>
                <li class="">
                    
    <a class="" href="../assets/">Adding assets</a>
                </li>
                <li class="">
                    
    <a class="" href="../add-new-map/">Adding a new map</a>
                </li>
                <li class="">
                    
    <a class="" href="../add-new-ego-vehicle/">Adding a new ego vehicle</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">NPC map navigation</a>
    <ul class="subnav">
            
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../ros2-bridge/">Setting up ROS 2 bridge</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Plugins</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../sensor-plugins/">Sensor plugins</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../lidar-plugin/">Lidar sensor plugin</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../bridge-plugins/">Bridge plugins</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../controllable-plugins/">Controllable plugins</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../npc-plugins/">Traffic behavior plugins</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../ego-vehicle-dynamics/">Vehicle dynamics</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Point cloud</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../pointcloud-import/">Point cloud import</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../pointcloud-rendering/">Point cloud rendering</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../unity-help/">Unity help</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Support</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../troubleshooting/">Troubleshooting</a>
                </li>
                <li class="">
                    
    <a class="" href="../faq/">FAQ</a>
                </li>
                <li class="">
                    
    <a class="" href="../contributing/">Contributing</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">LGSVL Simulator</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Advanced &raquo;</li>
        
      
    
    <li>NPC map navigation</li>
    <li class="wy-breadcrumbs-aside">
      
      <!-- edited to not display Github edit link -->
        <a style="display:none;" href="https://github.com/lgsvl/simulator/edit/master/Docs/npc-map-navigation.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1>NPC Map Navigation</h1>
<p>In the latest Simulator Release, NPC vehicles follow the annotated HD map. <strong>No</strong> extra steps are required.</p>
<p>The following tutorial works with Simulator Release <a href="https://github.com/lgsvl/simulator/releases/tag/2019.05">2019.05</a></p>
<p><a href="../images/full_size_images/NPCSetup.jpg"><img alt="NPCSetup" src="../images/NPCSetup.jpg" /></a></p>
<p>Non-player character (NPC) vehicles now use the MapSegmentBuilder classes to navigate annotated maps.</p>
<h5>Map Manager</h5>
<p><a href="../images/full_size_images/NPCSetup_MapManager.jpg"><img alt="" src="../images/NPCSetup_MapManager.jpg" /></a></p>
<p>Use SanFrancisco.scene as a template to build map data for NPCs.</p>
<ol>
<li>Remove <span style='color:blue'>SFTraffic_New.prefab</span> from scene and any associated scripts, e.g., TrafPerformanceManager.cs, TrafInfoManager.cs and TrafSystem.cs.</li>
<li>Create a new GameObject at position Vector3.zero and Quaternion.identity, named <span style='color:blue'>Map</span>.</li>
<li>Add MapManager.cs component to this object and save as a <span style='color:blue'>prefab</span> in project assets.</li>
<li>The public field, SpawnLanesHolder, of MapManager.cs requires the <span style='color:blue'>MapLaneSegmentBuilder</span> holder transform.</li>
<li>The public field, IntersectionsHolder, of MapManager.cs requires the <span style='color:blue'>TrafficLights</span> holder transform.  This has intersection meshes and scripts for lights.</li>
<li>The public fields Green, Yellow, and Red are materials for the segmentation camera system.  If using the Traffic meshes from SanFrancisco.scene, these need to be added here.  If not, IntersectionComponent.cs and associated scripts will need to be edited.</li>
</ol>
<h5>Map Lane and Intersection Grouping</h5>
<p><a href="../images/full_size_images/NPCSetup_MapBuilderIntersectionGroup.jpg"><img alt="NPCSetup_IntersectionMapBuilder" src="../images/NPCSetup_MapBuilderIntersectionGroup.jpg" /></a></p>
<ol>
<li>Create <span style='color:blue'>TrafficLanes</span> holder object as a child of <span style='color:blue'>Map.prefab</span>.</li>
<li>Place all <span style='color:blue'>MapLaneSegmentBuilder</span> objects into <span style='color:blue'>TrafficLanes</span> holder object for all non intersection lanes.</li>
<li>Create <span style='color:blue'>IntersectionLanes</span> holder object as a child of <span style='color:blue'>Map.prefab</span>.</li>
<li>Create a new <span style='color:blue'>Intersection</span> holder object as a child of <span style='color:blue'>IntersectionLanes</span> transform for each intersection annotation.  <strong>Be sure its world position is in the center of each intersection.</strong></li>
<li>Place <span style='color:blue'>MapLaneSegmentBuilder</span> and <span style='color:blue'>MapStopLineSegmentBuilder</span> objects into <span style='color:blue'>Intersection</span> holder object for each intersection.</li>
</ol>
<h5>Map Intersection Builder</h5>
<p><a href="../images/full_size_images/NPCSetup_IntersectionMapBuilder.jpg"><img alt="NPCSetup_IntersectionMapBuilder" src="../images/NPCSetup_IntersectionMapBuilder.jpg" /></a></p>
<ol>
<li>For each <span style='color:blue'>Intersection</span> holder, add the MapIntersectionBuilder.cs component.</li>
</ol>
<h5>Traffic Lights</h5>
<p><a href="../images/full_size_images/NPCSetup_TrafficLight01.jpg"><img alt="NPCSetup_TrafficLight01" src="../images/NPCSetup_TrafficLight01.jpg" /></a></p>
<ol>
<li>Create a <span style='color:blue'>TrafficLights</span> holder object to hold all traffic light meshes or place all traffic meshes under the map annotation <span style='color:blue'>Intersections</span>.  Just be sure to have the root holder be in MapManager.cs IntersectionHolder public reference.</li>
<li>Create a <span style='color:blue'>Intersection</span> holder object.  <strong>Be sure its world position is in the center of each intersection.</strong></li>
<li>Add IntersectionComponent.cs to each <span style='color:blue'>Intersection</span> holder object.</li>
</ol>
<p><a href="../images/full_size_images/NPCSetup_TrafficLight02.jpg"><img alt="NPCSetup_TrafficLight02" src="../images/NPCSetup_TrafficLight02.jpg" /></a></p>
<ol>
<li>Place <span style='color:blue'>TrafficLightPole</span> facing it's corresponding <span style='color:blue'>StopLineSegmentBuilder</span> object.  <strong>The transfom needs to be Z axis or gizmo arrow forward, parallel to the StopLineSegmentBuilder object Z axis or gizmo arrow forward.</strong></li>
<li>Add IntersectionTrafficLightSetComponent.cs.</li>
<li>Place as a child of the <span style='color:blue'>Intersection</span> holder object.</li>
<li>For opposite facing <span style='color:blue'>TrafficLightPoles</span> and <span style='color:blue'>StopLineSegmentBuilders</span>, <strong>be sure to orient transforms in Z axis or gizmo arrow forward but perpendicular to other facing light poles and stoplines.</strong>  </li>
</ol>
<p><a href="../images/full_size_images/NPCSetup_TrafficLight03.jpg"><img alt="NPCSetup_TrafficLight03" src="../images/NPCSetup_TrafficLight03.jpg" /></a></p>
<ol>
<li>Add <span style='color:blue'>TrafficLight</span> meshes as children of the <span style='color:blue'>TrafficLightPole</span>.</li>
<li>Add IntersectionTrafficLightSetComponent.cs to each <span style='color:blue'>TrafficLight</span>.</li>
</ol>
<h5>StopLine and MapLaneSegmentBuilder overlap</h5>
<p><a href="../images/full_size_images/NPCSetup_StopLineAndLaneOverlap.jpg"><img alt="NPCSetup_StopLineAndLaneOverlap" src="../images/NPCSetup_StopLineAndLaneOverlap.jpg" /></a></p>
<p><strong>MapLaneSegmentBuilders final waypoint needs to be slightly overlapping the MapStopLineBuilder</strong></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../ros2-bridge/" class="btn btn-neutral float-right" title="Setting up ROS 2 bridge">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../add-new-ego-vehicle/" class="btn btn-neutral" title="Adding a new ego vehicle"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2019-2020 LG Electronics Inc.</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/lgsvl/simulator/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../add-new-ego-vehicle/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../ros2-bridge/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../javascripts/clipboard.js" defer></script>
      <script src="../javascripts/copy-to-clipboard.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
